<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NCG SDK for Android: Basic implementation Guides</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo_inka.jpg"/></td>
  <td id="projectalign">
   <div id="projectname">NCG SDK for Android<span id="projectnumber">&#160;Build 20221105</span>
   </div>
   <div id="projectbrief">INKA Entworks NCG DRM Library for Android</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('implementation_basic_guides.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Basic implementation Guides </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PallyCon_implematation_Guide_Android_ENG.md</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="a-namedoc_topapallycon-android-sdk-application-guide"><a></a>PallyCon Android SDK Application Guide</h1>
<h2 id="development-environment-setting">1. Development Environment Setting</h2>
<blockquote>
<p><strong>NOTE</strong><br>
This document is prepared in accordance with the following environment.</p>
</blockquote>
<p>For the installation of PallyCon Android SDK, only copy the files.<br>
Since PallyCon Android SDK consists of jar and so files, there’s no need of a separate installation but just copy the appropriate files to the library folder (libs) of Application project to which SDK applies.<br>
As shown in demo project, in order to apply PallyCon Android SDK to a separate project, you can set project according to the following steps:</p>
<ol>
<li>
<p>Copy so files to libs/armeabi folder.</p>
</li>
<li>
<p>Copy ncg2sdk.jar file to libs folder.</p>
</li>
<li>
<p>As shown in the following figure, add ncg2sdk.jarfile to “Java Build Path”.</p>
</li>
</ol>
<p><img src="build_setting.png" width="700" height="450"></p>
<ol start="4">
<li>Also as shown in the following figure, check ncg2sdk.jar on “Order and Export” tab.</li>
</ol>
<p><img src="build_setting_check.png" width="700" height="450"></p>
<blockquote>
<p><strong>NOTE</strong><br>
In case of managing jar files by generating another folder in libs folder within project, FATAL error may occur when running App.<br>
In this case, check ncg2sdk.jar on “Order and Export” tab.</p>
</blockquote>
<p><a href="#doc_top">Top</a></p>
<hr>
<h3 id="androidmanifest.xml-authorization-setting">AndroidManifest.xml Authorization Setting</h3>
<p>For a normal use of PallyCon Android SDK, the authorizations to be basically required are as follows:</p>

<table>
<thead>
<tr>
<th>Item</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>READ_LOGS</td>
<td>Authority to read LOG</td>
</tr>
<tr>
<td>INTERNET</td>
<td>Authority to use network</td>
</tr>
<tr>
<td>WRITE_EXTERNAL_STORAGE</td>
<td>Authority to use external storage</td>
</tr>
<tr>
<td>READ_PHONE_STATE</td>
<td>Authority to read the status of device</td>
</tr>
<tr>
<td>MOUNT_UNMOUNT_FILESYSTEMS</td>
<td>Authority to edit file system</td>
</tr>
</tbody>
</table><p><a href="#doc_top">Top</a></p>
<hr>
<h2 id="initialization">2. Initialization</h2>
<p>Core object is generated only one while App is running in a single tone.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoLibrary</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">static</span> Ncg2Agent g_ncgAgent <span class="token operator">=</span> Ncg2SdkFactory<span class="token punctuation">.</span><span class="token function">getNcgAgentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> Ncg2Agent <span class="token function">getNcgAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> g_ncgAgent<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In order to use Ncg2Agent object, necessarily perform the initialization work through init() method.<br>
In general, init() method of Ncg2Agent is called at a time when App starts (onCreate of android.app.Application).<br>
It is noted that if internal methods are called when Ncg2Agent object has not been initialized or already released, an error occurs.</p>

<table>
<thead>
<tr>
<th>Item</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>NotSupportOffline</td>
<td>Not support offline mode</td>
</tr>
<tr>
<td>OfflineSupport</td>
<td>Support offline mode</td>
</tr>
</tbody>
</table><p>If you set the offlice policy to ‘OfflineSupport’ then you can limit the count of execution.<br>
The default limit count is 10 and the value can be changed by calling the method of setCountOfExecutionLimit of OfflineSupportPolicy enum class.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoApplication</span> <span class="token keyword">extends</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initializeNcgAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initializeNcgAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            DemoLibrary<span class="token punctuation">.</span><span class="token function">getNcgAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setHttpRequestCallback</span><span class="token punctuation">(</span>mHttpRequestCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Ncg2Agent<span class="token punctuation">.</span>OfflineSupportPolicy policy <span class="token operator">=</span> Ncg2Agent<span class="token punctuation">.</span>OfflineSupportPolicy<span class="token punctuation">.</span>OfflineSupport<span class="token punctuation">;</span>
            policy<span class="token punctuation">.</span><span class="token function">setCountOfExecutionLimit</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            DemoLibrary<span class="token punctuation">.</span><span class="token function">getNcgAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> policy<span class="token punctuation">)</span><span class="token punctuation">;</span>
            DemoLibrary<span class="token punctuation">.</span><span class="token function">getNcgAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enableLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Ncg2Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            String errorMsg <span class="token operator">=</span> <span class="token string">"Exception in init() : "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Log<span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>DemoLibrary<span class="token punctuation">.</span>TAG<span class="token punctuation">,</span> errorMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> errorMsg<span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Controlling HTTP communication inside PallyCon Android SDK requires implementing HttpRequestCallback in App and then initialize it before setting Callback.<br>
Setting HttpRequestCallback Callback object requires using Ncg2Agent.setHttpRequestCallback method.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoApplication</span> <span class="token keyword">extends</span> <span class="token class-name">Application</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> Ncg2Agent<span class="token punctuation">.</span>HttpRequestCallback mHttpRequestCallback <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ncg2Agent<span class="token punctuation">.</span>HttpRequestCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> String <span class="token function">sendRequest</span><span class="token punctuation">(</span>String url<span class="token punctuation">,</span> String param<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">sendRequestResponseBytes</span><span class="token punctuation">(</span>String url<span class="token punctuation">,</span> String param<span class="token punctuation">)</span> <span class="token keyword">throws</span> NcgHttpRequestException <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">sendRequest</span><span class="token punctuation">(</span>String url<span class="token punctuation">,</span> String param<span class="token punctuation">,</span> <span class="token keyword">int</span> begin<span class="token punctuation">,</span> <span class="token keyword">int</span> end<span class="token punctuation">)</span> <span class="token keyword">throws</span> NcgHttpRequestException <span class="token punctuation">{</span>    
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initializeNcgAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        DemoLibrary<span class="token punctuation">.</span><span class="token function">getNcgAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setHttpRequestCallback</span><span class="token punctuation">(</span>mHttpRequestCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre>
<p><a href="#doc_top">Top</a></p>
<hr>
<h2 id="license">3. License</h2>
<h3 id="confirmation-of-license">Confirmation of License</h3>
<p>In order to use the content applying DRM, you must be obtained a license.<br>
Licensed file contains the authorization of content including effective period, play count, and whether TV-out is permitted, etc.<br>
Thus, playing the content requires the issuance of license from the server; if there’s no license or if any, it is not valid, using DRM content shall be restricted.<br>
For the confirmation of license, the functions to be provided by PallyCon Android SDK are as follows:</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">interface</span> <span class="token class-name">Ncg2Agent</span><span class="token punctuation">{</span>
    <span class="token comment">// Confirm whether a file situated in the entered path and URL is NCG file.</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isNcgContent</span><span class="token punctuation">(</span>String strFileOrURL<span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2Exception
    
    <span class="token comment">// Confirm the license of file situated in the entered path and URL for validity.</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isLicenseValid</span><span class="token punctuation">(</span>String strFileOrURL<span class="token punctuation">)</span> <span class="token keyword">throw</span> Ncg2Exception
    
    <span class="token comment">// Confirm the license of content for validity.</span>
    <span class="token keyword">public</span> LicenseValidation <span class="token function">checkLicenseValid</span><span class="token punctuation">(</span>String path<span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2Exception
<span class="token punctuation">}</span>
</code></pre>
<p>LicenseValidation enum type returned from checkLicenseValid method is as follows:</p>

<table>
<thead>
<tr>
<th>Item</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ValidLicense</td>
<td>Valid license</td>
</tr>
<tr>
<td>NotExistLicense</td>
<td>No license or invalid license</td>
</tr>
<tr>
<td>ExternalDeviceDisallowed</td>
<td>License with external output device disallowed</td>
</tr>
<tr>
<td>RootedDeviceDisallowed</td>
<td>License disallowed from rooted terminal</td>
</tr>
<tr>
<td>ExpiredLicense</td>
<td>Expired license</td>
</tr>
<tr>
<td>ExceededPlayCount</td>
<td>License with play count exceeded</td>
</tr>
<tr>
<td>DeviceTimeModified</td>
<td>Detected the device time modified</td>
</tr>
<tr>
<td>OfflineNotSupported</td>
<td>Failed to access server and detected offline in the course of initializing under the policy not supporting offline mode</td>
</tr>
<tr>
<td>OfflineStatusTooLong</td>
<td>A state necessary of online mode because of too many cases executed offline. For more information, refer to the following note.</td>
</tr>
<tr>
<td>NotAuthorizedAppID</td>
<td>Failed to initialize since the executing App is not authenticated in server</td>
</tr>
<tr>
<td>ScreenRecorderDetected</td>
<td>Detected a screen recording app</td>
</tr>
</tbody>
</table><p>In Sample Project, confirm license for validity in the following order.</p>
<pre class=" language-java"><code class="prism  language-java">    <span class="token keyword">if</span><span class="token punctuation">(</span> DemoLibrary<span class="token punctuation">.</span><span class="token function">getNcgAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNcgContent</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    Ncg2Agent<span class="token punctuation">.</span>LicenseValidation validation <span class="token operator">=</span> DemoLibrary<span class="token punctuation">.</span><span class="token function">getNcgAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">checkLicenseValid</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> validation <span class="token operator">==</span> LicenseValidation<span class="token punctuation">.</span>ValidLicense <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Routine to process license for validity</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> validation <span class="token operator">==</span> LicenseValidation<span class="token punctuation">.</span>NotExistLicense <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// No license or invalid license</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        
            <span class="token comment">// Request license to license server</span>
            DemoLibrary<span class="token punctuation">.</span><span class="token function">getNcgAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">acquireLicenseByPath</span><span class="token punctuation">(</span> path<span class="token punctuation">,</span> DemoLibrary<span class="token punctuation">.</span><span class="token function">getUserID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DemoLibrary<span class="token punctuation">.</span><span class="token function">getOrderID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> DemoLibrary<span class="token punctuation">.</span><span class="token function">getNcgAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">checkLicenseValid</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">==</span> LicenseValidation<span class="token punctuation">.</span>ValidLicense <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Acquire valid license from server</span>
            
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// Not acquire license from server</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> validation <span class="token operator">==</span> LicenseValidation<span class="token punctuation">.</span>ExternalDeviceDisallowed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Not allow to play to the connection to external device such as HDMI device</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> validation <span class="token operator">==</span> LicenseValidation<span class="token punctuation">.</span>RootedDeviceDisallowed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// License not allowed in Rooting terminal.</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>validation <span class="token operator">==</span> LicenseValidation<span class="token punctuation">.</span>ExpiredLicense<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// Expired license</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>validation <span class="token operator">==</span> LicenseValidation<span class="token punctuation">.</span>ExceededPlayCount<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// Frequency license with play count exceeded</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>validation <span class="token operator">==</span> LicenseValidation<span class="token punctuation">.</span>ScreenRecorderDetected <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// You can check the package name and the appName of screen recorder app.</span>
            HashMap<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>String<span class="token operator">&gt;</span> data <span class="token operator">=</span> validation<span class="token punctuation">.</span><span class="token function">getExtraData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            String appName <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"AppName"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            String packageName <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"AppPackageName"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p><strong>NOTE</strong><br>
In order to detect the cases where a user intentionally changes device time,<br>
in the other license types other than unlimited license, if it executes more than limit value set by setCountOfExecutionLimit method in the internal offline mode, OfflineStatusTooLong value is returned.<br>
OfflineStatusTooLong value is only operated when it is set as OfflineSupport parameter option at init() method called.</p>
</blockquote>
<p><a href="#doc_top">Top</a></p>
<hr>
<h3 id="issuance-and-renewal-of-license">Issuance and Renewal of License</h3>
<p>No license or expired license requires the issuance of license suitable for the applicable content. The license may be issued at any time before actual use; however, SDK Sample App Project tries to issue license at a time to play. The timing to issue license depends on App scenario, but the license is generally requested at a time to play.<br>
The functions supported by PallyCon Android SDK to issue license are as follows:</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">interface</span> <span class="token class-name">Ncg2Agent</span><span class="token punctuation">{</span>
    <span class="token comment">// Acquire license via the entered path with UserID and OrderID.</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">acquireLicenseByPath</span><span class="token punctuation">(</span>String path<span class="token punctuation">,</span> String userId<span class="token punctuation">,</span> String orderId<span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2Exception

    <span class="token comment">// Acquire license via the entered path with UserID and OrderID, there can be acquired temporary license by setting a temporary.</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">acquireLicenseByPath</span><span class="token punctuation">(</span> String path<span class="token punctuation">,</span> String userID<span class="token punctuation">,</span> String orderID<span class="token punctuation">,</span> <span class="token keyword">boolean</span> temporary <span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2Exception<span class="token punctuation">;</span>

    <span class="token comment">// Acquire license using Content ID.</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">acquireLicenseByCID</span><span class="token punctuation">(</span>String cid<span class="token punctuation">,</span> String userID<span class="token punctuation">,</span> String orderID<span class="token punctuation">,</span> String acquisitionURL<span class="token punctuation">)</span> <span class="token keyword">throw</span> Ncg2Exception

    <span class="token comment">// Acquire license using Content ID.</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">acquireLicenseByCID</span><span class="token punctuation">(</span>String cid<span class="token punctuation">,</span> String userID<span class="token punctuation">,</span> String siteID<span class="token punctuation">,</span> String orderID<span class="token punctuation">,</span> String acquisitionURL<span class="token punctuation">)</span> <span class="token keyword">throw</span> Ncg2Exception

    <span class="token comment">// Acquire license using Content ID, there can be acquired temporary license by setting a temporary.</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">acquireLicenseByCID</span><span class="token punctuation">(</span>String cid<span class="token punctuation">,</span> String userID<span class="token punctuation">,</span> String siteID<span class="token punctuation">,</span> String orderID<span class="token punctuation">,</span> String acquisitionURL<span class="token punctuation">,</span> <span class="token keyword">boolean</span> temporary <span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2Exception<span class="token punctuation">;</span>        
<span class="token punctuation">}</span>
</code></pre>
<p>Unlike term license, frequency license requires confirming license information.<br>
If you use frequency license, the functions that deduct the frequency are provided by PallyCon Android SDK; and such deduction is conducted at a time when license is issued and virtual URL return is completed.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">private</span> OnPreparedListener mPreparedListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OnPreparedListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPrepared</span><span class="token punctuation">(</span>MediaPlayer mp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> mIsCountLimitedContent <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            DemoLibrary<span class="token punctuation">.</span><span class="token function">getNcgAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decreasePlayCount</span><span class="token punctuation">(</span>mNcgFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p><strong>NOTE</strong><br>
For remote content (PD/HLS), if network environment is not stable, license issuance and content playing may not be smoothly conducted.<br>
If there need acquire license whenever you play the content, it is preferable to acquire temporary license.<br>
For Downloaded Contents, if license has been issued, it may play in an environment without network. Thus, it is desirable to acquire license at a time that contents are completely downloaded (i.e., network is connected).</p>
</blockquote>
<p><a href="#doc_top">Top</a></p>
<hr>
<h3 id="license-deletion">License Deletion</h3>
<p>Already-issued license may be necessarily discarded in accordance with APP scenario. In this case, the functions related to license deletion are as follows, which you can use suitable for scenario. The temporary license may be terminated at any time after use; For the SDK Sample App Project, the license is terminated when the video play is stopped.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">interface</span> <span class="token class-name">Ncg2Agent</span><span class="token punctuation">{</span>
    <span class="token comment">// Delete license via all CIDs of the issued licenses.</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeLicenseAllCID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2Exception

    <span class="token comment">// Delete temporary license.</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">removeAllTemporaryLicense</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2Exception

    <span class="token comment">// Delete license via CID.</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeLicenseByCID</span><span class="token punctuation">(</span>strContentsID<span class="token punctuation">)</span> <span class="token keyword">throw</span> Ncg2Exception

    <span class="token comment">// Delete license of the content in the file path.</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeLicenseByPath</span><span class="token punctuation">(</span>strFilename<span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2Exception
<span class="token punctuation">}</span>
</code></pre>
<p><a href="#doc_top">Top</a></p>
<hr>
<h2 id="play">4. Play</h2>
<p>If license is normally issued using PallyCon Androide SDK, using Ncg2LocalWebServer interface, you can control LocalWebserver located inside.<br>
If you designate the path of PallyCon content to play PallyCon content, it can be used in a form to return virtual URL.<br>
After obtaining virtual URL you can access MediaPlayer or 3th Party Player provided by Android for playing.<br>
The followings are virtual URL return functions provided by Ncg2LocalWebServer.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">interface</span> <span class="token class-name">Ncg2LocalWebServer</span><span class="token punctuation">{</span>
    <span class="token comment">// In case of Local File,</span>
    <span class="token keyword">public</span> String <span class="token function">addLocalFilePathForPlayback</span><span class="token punctuation">(</span>Activity activity<span class="token punctuation">,</span> String url<span class="token punctuation">,</span> <span class="token keyword">long</span> fileSize<span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2InvalidLicenseException<span class="token punctuation">,</span> Ncg2Exception<span class="token punctuation">;</span>
    
    <span class="token comment">// In case of PD contents,</span>
    <span class="token keyword">public</span> String <span class="token function">addProgressiveDownloadUrlForPlayback</span><span class="token punctuation">(</span>Activity activity<span class="token punctuation">,</span> String url<span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2InvalidLicenseException<span class="token punctuation">,</span> Ncg2Exception<span class="token punctuation">;</span>
    
    <span class="token comment">// In case of HLS,</span>
    <span class="token keyword">public</span> String <span class="token function">addHttpLiveStreamUrlForPlayback</span><span class="token punctuation">(</span>Activity activity<span class="token punctuation">,</span> String url<span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2InvalidLicenseException<span class="token punctuation">,</span> Ncg2Exception<span class="token punctuation">;</span>

    <span class="token comment">// In case of HLS (live),</span>
    <span class="token keyword">public</span> String <span class="token function">addHttpLiveStreamUrlForPlayback</span><span class="token punctuation">(</span>Activity activity<span class="token punctuation">,</span> String url<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isLiveHLS<span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2InvalidLicenseException<span class="token punctuation">,</span> Ncg2Exception<span class="token punctuation">;</span>
    
    <span class="token comment">// In case of HLS,</span>
    <span class="token comment">// unlike addHttpLiveStreamUrlForPlayback(), do not prior check key file equivalent to m3u8 path.</span>
    <span class="token keyword">public</span> String <span class="token function">addHttpLiveStreamUrlForPlaybackWithoutChecking</span><span class="token punctuation">(</span>Activity activity<span class="token punctuation">,</span> String url<span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2InvalidLicenseException<span class="token punctuation">,</span> Ncg2Exception<span class="token punctuation">;</span>
    
    <span class="token comment">// In case of HLS,</span>
    <span class="token comment">// You can call this method to add HLS url without accessing the URLs of m3u8 and key file.</span>
    <span class="token keyword">public</span> String <span class="token function">addHttpLiveStreamUrlForPlayback</span><span class="token punctuation">(</span>Activity activity<span class="token punctuation">,</span> String url<span class="token punctuation">,</span> String cid<span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2InvalidLicenseException<span class="token punctuation">,</span> Ncg2Exception<span class="token punctuation">;</span>

    <span class="token comment">// In case of HLS (live),</span>
    <span class="token comment">// You can call this method to add HLS url without accessing the URLs of m3u8 and key file.</span>
    <span class="token keyword">public</span> String <span class="token function">addHttpLiveStreamUrlForPlayback</span><span class="token punctuation">(</span>Activity activity<span class="token punctuation">,</span> String url<span class="token punctuation">,</span> String cid<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isLiveHLS<span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2InvalidLicenseException<span class="token punctuation">,</span> Ncg2Exception<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The following code indicates how to obtain virtual URL from PallyCon contents.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PlayerActivity</span> <span class="token keyword">extends</span> <span class="token class-name">Activity</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>Bundle savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Ncg2Agent ncgAgent <span class="token operator">=</span> Ncg2SdkFactory<span class="token punctuation">.</span><span class="token function">getNcgAgentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Ncg2LocalWebServer ncgLocalWebServer <span class="token operator">=</span> ncgAgent<span class="token punctuation">.</span><span class="token function">getLocalWebServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ncgLocalWebServer<span class="token punctuation">.</span><span class="token function">setWebServerListener</span><span class="token punctuation">(</span>mWebServerCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ncgLocalWebServer<span class="token punctuation">.</span><span class="token function">clearPlaybackUrls</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span> mNcgFilePath<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">".m3u8"</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// HLS Playback</span>
                mPlaybackURL <span class="token operator">=</span> ncgLocalWebServer<span class="token punctuation">.</span><span class="token function">addHttpLiveStreamUrlForPlayback</span><span class="token punctuation">(</span>mNcgFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>mNcgFilePath<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"http://"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// PD Playback</span>
                mPlaybackURL <span class="token operator">=</span> ncgLocalWebServer<span class="token punctuation">.</span><span class="token function">addProgressiveDownloadUrlForPlayback</span><span class="token punctuation">(</span>mNcgFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// Local Playback</span>
                mPlaybackURL <span class="token operator">=</span> ncgLocalWebServer<span class="token punctuation">.</span><span class="token function">addLocalFilePathForPlayback</span><span class="token punctuation">(</span>mNcgFilePath<span class="token punctuation">,</span> mNcgFileSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Ncg2Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>MediaPlayerActivity<span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> 
                <span class="token string">"[onCreate] Error Occured. : "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p><strong>NOTE</strong><br>
HLS is supported in Android Media Player of more than Android 3.0.<br>
However, playing may not be smooth depending on device.</p>
</blockquote>
<p>The following code indicates how to decrypt and use virtual URL.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">try</span> <span class="token punctuation">{</span>
    mPlayer<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>mPlaybackURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mPlayer<span class="token punctuation">.</span><span class="token function">prepareAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    errorMsg <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalStateException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    errorMsg <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    errorMsg <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><a href="#doc_top">Top</a></p>
<hr>
<h3 id="localwebserver-callback">LocalWebserver Callback</h3>
<p>Ncg2LocalWebServer internally uses Web Server in a proxy form; the information of event from this Web Server outside SDK uses WebServerListener interface.<br>
As shown in the following codes, you can process notice or error of Ncg2LocalWebserver.<br>
It is noted that you confirm whether onCheckPlayerStatus()method is in an applicable state of player before returning.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">private</span> Ncg2LocalWebServer<span class="token punctuation">.</span>WebServerListener mWebServerCallback <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ncg2LocalWebServer<span class="token punctuation">.</span>WebServerListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNotification</span><span class="token punctuation">(</span><span class="token keyword">int</span> notificationCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//Most of notice codes should be ignored.</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token keyword">int</span> errorCode<span class="token punctuation">,</span> String errorMessage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//Show the applicable user error message.</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> PlayerState <span class="token function">onCheckPlayerStatus</span><span class="token punctuation">(</span>String uri<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mIsPrepared<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//Only when player can play, return</span>
            PlayerState<span class="token punctuation">.</span>ReadyToPlay<span class="token punctuation">.</span>
            <span class="token keyword">return</span> PlayerState<span class="token punctuation">.</span>ReadyToPlay<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// Block playing when PlayerState.Fail is returned.</span>
            <span class="token keyword">return</span> PlayerState<span class="token punctuation">.</span>Fail<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p><strong>NOTE</strong><br>
In order to prevent the case where a hacker accesses via virtual URL to download data, check the state of Player.<br>
When accessed via virtual URL but not under playing, it is to block decrypting.</p>
</blockquote>
<p><a href="#doc_top">Top</a></p>
<hr>
<h3 id="file-decryption">File Decryption</h3>
<p>PallyCon Android SDK provides the function to also decrypt ordinary NCG files.<br>
NcgFile object is returned from Ncg2Agent to proceed the order from open to read.<br>
The following is the function to be provided for NcgFile:</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">interface</span> <span class="token class-name">Ncg2Agent</span><span class="token punctuation">{</span>
    <span class="token comment">//Return NcgFile object.</span>
    <span class="token keyword">public</span> NcgFile <span class="token function">createNcgFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">interface</span> <span class="token class-name">NcgFile</span><span class="token punctuation">{</span>
        <span class="token comment">//Open NCG file.</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">open</span><span class="token punctuation">(</span>String path<span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2InvalidLicenseException<span class="token punctuation">,</span> Ncg2InvalidNcgFileException<span class="token punctuation">,</span> Ncg2Exception<span class="token punctuation">;</span>
        <span class="token comment">//Set license and open NCG file.</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">open</span><span class="token punctuation">(</span>String path<span class="token punctuation">,</span> <span class="token keyword">boolean</span> prepare<span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2InvalidLicenseException<span class="token punctuation">,</span> Ncg2InvalidNcgFileException<span class="token punctuation">,</span> Ncg2Exception<span class="token punctuation">;</span>
        <span class="token comment">//Call the applicable method in a status after open and make it a status to enable decrypting. </span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2InvalidLicenseException<span class="token punctuation">,</span> Ncg2InvalidNcgFileException<span class="token punctuation">,</span> Ncg2Exception<span class="token punctuation">;</span>
        <span class="token comment">//Close the opened file.</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//Read content data from NCG file.</span>
        <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buff<span class="token punctuation">,</span> <span class="token keyword">long</span> sizeToRead<span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2Exception<span class="token punctuation">;</span>
        <span class="token comment">//Move the location of file pointer to read.</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">seek</span><span class="token punctuation">(</span><span class="token keyword">long</span> offset<span class="token punctuation">,</span> SeekMethod seekMethod<span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2Exception<span class="token punctuation">;</span>
        <span class="token comment">//Return the current location of file pointer.</span>
        <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getCurrentFilePointer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2Exception<span class="token punctuation">;</span>
        <span class="token comment">//Return the size of NCG file header.</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getHeaderSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2Exception<span class="token punctuation">;</span>
        <span class="token comment">//Return InputStream for NCG file.</span>
        <span class="token keyword">public</span> InputStream <span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Ncg2Exception<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<p>The following is a sample code to make original content using NcgFile object.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">try</span> <span class="token punctuation">{</span>
    String ncgFilePath <span class="token operator">=</span> mFilePath<span class="token punctuation">;</span>
    ncgFile <span class="token operator">=</span> DemoLibrary<span class="token punctuation">.</span><span class="token function">getNcgAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createNcgFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ncgFile<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>ncgFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ncgFile<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SeekMethod<span class="token punctuation">.</span>End<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// the original file's size will be used for checking success of decryption.</span>
    <span class="token keyword">long</span> contentFileSize <span class="token operator">=</span> ncgFile<span class="token punctuation">.</span><span class="token function">getCurrentFilePointer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ncgFile<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SeekMethod<span class="token punctuation">.</span>Begin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> pos <span class="token operator">=</span> mFilePath<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// removes ".ncg" in the path of NCG file</span>
    String unpackFilePath <span class="token operator">=</span> ncgFilePath<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> pos<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"unpackFile.mp4"</span><span class="token punctuation">;</span>
    fileOutStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>unpackFilePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> totalReadBytes <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token boolean">true</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> readBytes <span class="token operator">=</span> ncgFile<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> readBytes <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        fileOutStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>readBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        totalReadBytes <span class="token operator">+=</span> readBytes<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> totalReadBytes <span class="token operator">==</span> contentFileSize <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>DemoLibrary<span class="token punctuation">.</span>TAG<span class="token punctuation">,</span> <span class="token string">"Decryption succeeded"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>DemoLibrary<span class="token punctuation">.</span>TAG<span class="token punctuation">,</span> <span class="token string">"Decryption failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>mainActivity<span class="token punctuation">,</span> <span class="token string">"[unpackNcgFiles] decryption failed"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Ncg2Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p><strong>NOTE</strong><br>
If making a file after decrypting, there is a risk to expose original file.<br>
Thus, it is recommended to decrypt and use it only in memory.</p>
</blockquote>
<p><a href="#doc_top">Top</a></p>
<hr>
<h2 id="release">5. Release</h2>
<p>After Ncg2Agent object ends its use, release() method should be called for release.<br>
release() method should be called at a time to end App (i.e., when a user explicitly ends App).<br>
Sample App generates dialog in OnBackPressed() method to call release() method.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">case</span> DIALOG_EXIT <span class="token operator">:</span>
    builder<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span> <span class="token function">getString</span><span class="token punctuation">(</span> R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>confirm_end <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">setPositiveButton</span><span class="token punctuation">(</span> <span class="token function">getString</span><span class="token punctuation">(</span> R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>yes <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DialogInterface<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span>DialogInterface dialog<span class="token punctuation">,</span> <span class="token keyword">int</span> which<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            DemoLibrary<span class="token punctuation">.</span><span class="token function">getNcgAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">setNegativeButton</span><span class="token punctuation">(</span> R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>no<span class="token punctuation">,</span> null <span class="token punctuation">)</span><span class="token punctuation">;</span>
    dialog <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p><strong>NOTE</strong><br>
There is a case to call Ncg2Agent.release method in onTerminate method of Application; however, onTerminate method is not often explicitly called so that it is not desirable to call Ncg2Agent.release method in onTerminate.</p>
</blockquote>
<p><a href="#doc_top">Top</a></p>
<hr>
<h2 id="error-processing">6. Error Processing</h2>
<p>A mechanism to process errors in PallyCon Android SDK is implemented through Exception.</p>
<p>There is Ncg2Exception class which is a basic exception class; and then there exist a variety of separate exception classes which inherit the aforesaid class.<br>
NcgException class is a basic exception class of PallyCon SDK, which has internally as its member, ErrorCode and Error Message.<br>
If ErrorCode is set, ErrorCode can be confirmed with getErrorCode() method; if ErrorCode is not set, -1 is returned.<br>
Error Message can be confirmed with getMessage() method.<br>
The following is an example code to catch Ncg2Exception exception when calling for the case to use setDataSource() method of Ncg2Player.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token keyword">try</span> <span class="token punctuation">{</span>
    mPlayer<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>mNcgFilePath<span class="token punctuation">,</span> mNcgFileSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mPlayer<span class="token punctuation">.</span><span class="token function">prepareAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Ncg2Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    errorMsg <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    errorMsg <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalStateException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    errorMsg <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    errorMsg <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="etc">7. Etc</h2>
<h3 id="testing-in-emulator">Testing in emulator</h3>
<p>When developing an app, it is an API for users that can only be developed in an emulator environment. When distributing an actual app, it must be removed or called ‘disableVirtualMachine()’.</p>
<pre class=" language-java"><code class="prism  language-java"><span class="token comment">//enable</span>
Ncg2Agent ncgAgent <span class="token operator">=</span> Ncg2SdkFactory<span class="token punctuation">.</span><span class="token function">getNcgAgentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ncgAgent<span class="token punctuation">.</span><span class="token function">enableVirtualMachine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//disable</span>
ncgAgent<span class="token punctuation">.</span><span class="token function">disableVirtualMachine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><a href="#doc_top">Top</a></p>
<hr>
</div>
</body>

</html>
  </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
